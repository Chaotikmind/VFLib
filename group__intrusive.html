<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>VFLib: intrusive</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">VFLib
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle">
<div class="title">intrusive</div>  </div>
<div class="ingroups"><a class="el" href="group__vf__core.html">vf_core</a></div></div><!--header-->
<div class="contents">

<p>Intrusive Containers.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for intrusive:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__intrusive.png" border="0" alt="" usemap="#group____intrusive"/>
<map name="group____intrusive" id="group____intrusive">
<area shape="rect" id="node1" href="group__vf__core.html" title="Core classes." alt="" coords="6,43,69,69"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_list.html">List&lt; Element, Tag &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Intrusive doubly linked list.  <a href="class_list.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_list_default_tag.html">ListDefaultTag</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default tag for <a class="el" href="class_list.html" title="Intrusive doubly linked list.">List</a>.  <a href="struct_list_default_tag.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_lock_free_queue.html">LockFreeQueue&lt; Element, Tag &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Multiple Producer, Single Consumer (MPSC) intrusive FIFO.  <a href="class_lock_free_queue.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_lock_free_queue_default_tag.html">LockFreeQueueDefaultTag</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default tag for <a class="el" href="class_lock_free_queue.html" title="Multiple Producer, Single Consumer (MPSC) intrusive FIFO.">LockFreeQueue</a>.  <a href="struct_lock_free_queue_default_tag.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_lock_free_stack.html">LockFreeStack&lt; Element, Tag &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Multiple Producer, Multiple Consumer (MPMC) intrusive stack.  <a href="class_lock_free_stack.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_lock_free_stack_default_tag.html">LockFreeStackDefaultTag</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default tag for <a class="el" href="class_lock_free_stack.html" title="Multiple Producer, Multiple Consumer (MPMC) intrusive stack.">LockFreeStack</a>.  <a href="struct_lock_free_stack_default_tag.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Intrusive Containers. </p>
<h1>Introduction</h1>
<p>Intrusive containers are special containers that offer better performance and exception safety guarantees than non-intrusive containers (like the STL containers). They are useful building blocks for high performance concurrent systems or other purposes where allocations are restricted (such as the <a class="elRef" doxygen="juce.tag:http://www.rawmaterialsoftware.com/juce/api//" href="http://www.rawmaterialsoftware.com/juce/api/classAudioIODeviceCallback.html">AudioIODeviceCallback</a> object), because intrusive list operations do not allocate or free memory.</p>
<p>While intrusive containers were and are widely used in C, they became more and more forgotten in C++ due to the presence of the standard containers which don't support intrusive techniques. VFLib not only reintroduces this technique to C++ for lists, it also encapsulates the implementation in a mostly compliant STL interface. Hence anyone familiar with standard containers can easily use them.</p>
<h1>Interface</h1>
<p>The interface for intrusive elements in this library is unified for all containers. Unlike STL containers, objects placed into intrusive containers are not copied. Instead, a pointer to the object is stored. All responsibility for object lifetime is the responsibility of the caller; the intrusive container just keeps track of what is in it.</p>
<p>Summary of intrusive container differences:</p>
<ul>
<li>Holds pointers to existing objects instead of copies.</li>
</ul>
<ul>
<li>Does not allocate or free any objects.</li>
</ul>
<ul>
<li>Requires a element's class declaration to be modified.</li>
</ul>
<ul>
<li>Methods never throw exceptions when called with valid arguments.</li>
</ul>
<h1>Usage</h1>
<p>Like STL containers, intrusive containers are all template based, where the template argument specifies the type of object that the container will hold. These declarations specify a doubly linked list where each element points to a user defined class:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Object; <span class="comment">// Forward declaration</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="class_list.html" title="Intrusive doubly linked list.">List &lt;Object&gt;</a> list; <span class="comment">// Doubly-linked list of Object</span></div>
</div><!-- fragment --><p>Because intrusive containers allocate no memory, allowing objects to be placed inside requires a modification to their class declaration. Each intrusive container declares a nested class <code>Node</code> which elements must be derived from, using the Curiously Recurring Template Pattern (CRTP). We will continue to fully declare the Object type from the previous example to support emplacement into an intrusive container:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Object : <span class="keyword">public</span> <a class="code" href="class_list.html" title="Intrusive doubly linked list.">List</a> &lt;Object&gt;::Node <span class="comment">// Required for List</span></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="keywordtype">void</span> performAction ();</div>
<div class="line">};</div>
</div><!-- fragment --><p>Usage of a typedef eliminates redundant specification of the template arguments but requires a forward declaration. The following code is equivalent.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>Object; <span class="comment">// Forward declaration</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Specify template parameters just once</span></div>
<div class="line"><span class="keyword">typedef</span> <a class="code" href="class_list.html" title="Intrusive doubly linked list.">List &lt;Object&gt;</a> ListType;</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>Object : <span class="keyword">public</span> ListType::Node</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">void</span> performAction ();</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">ListType::Node list;</div>
</div><!-- fragment --><p>With these declarations we may proceed to create our objects, add them to the list, and perform operations:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a few objects and put them in the list</span></div>
<div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; 5; ++i)</div>
<div class="line">  list.push_back (*<span class="keyword">new</span> Object);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Call a method on each list</span></div>
<div class="line"><span class="keywordflow">for</span> (ListType::iterator iter = list.begin(); iter != list.end (); ++iter)</div>
<div class="line">  iter-&gt;performAction ();</div>
</div><!-- fragment --><p>Unlike regular STL containers, an object derived from an intrusive container node cannot exist in more than one instance of that list at a time. This is because the bookkeeping information for maintaining the list is kept in the object rather than the list.</p>
<p>To support objects existing in multiple containers, templates variations are instantiated by distinguishing them with an empty structure, called a tag. The object is derived from multiple instances of Node, where each instance specifies a unique tag. The tag is passed as the second template argument. When the second argument is unspecified, the default tag is used.</p>
<p>This declaration example shows the usage of tags to allow an object to exist simultaneously in two separate lists:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>GlobalListTag { }; <span class="comment">// list of all objects</span></div>
<div class="line"><span class="keyword">struct </span>ActiveListTag { }; <span class="comment">// subset of all objects that are active</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>Object : <span class="keyword">public</span> <a class="code" href="class_list.html" title="Intrusive doubly linked list.">List</a> &lt;Object, GlobalListTag&gt;</div>
<div class="line">             , <span class="keyword">public</span> <a class="code" href="class_list.html" title="Intrusive doubly linked list.">List</a> &lt;Object, ActiveListTag&gt;</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  Object () : m_isActive (false)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// Add ourselves to the global list</span></div>
<div class="line">    s_globalList.push_front (*<span class="keyword">this</span>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  ~Object ()</div>
<div class="line">  {</div>
<div class="line">    deactivate ();</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">void</span> becomeActive ()</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// Add ourselves to the active list</span></div>
<div class="line">    <span class="keywordflow">if</span> (!m_isActive)</div>
<div class="line">    {</div>
<div class="line">      s_activeList.push_front (*<span class="keyword">this</span>);</div>
<div class="line">      m_isActive = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">void</span> deactivate ()</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (m_isActive)</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// Doesn&#39;t delete the object</span></div>
<div class="line">      s_activeList.erase (s_activeList.iterator_to (<span class="keyword">this</span>));</div>
<div class="line"></div>
<div class="line">      m_isActive = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">bool</span> m_isActive;</div>
<div class="line"></div>
<div class="line">  <span class="keyword">static</span> <a class="code" href="class_list.html" title="Intrusive doubly linked list.">List &lt;Object, GlobalListTag&gt;</a> s_globalList;</div>
<div class="line">  <span class="keyword">static</span> <a class="code" href="class_list.html" title="Intrusive doubly linked list.">List &lt;Object, ActiveListTag&gt;</a> s_activeList;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
